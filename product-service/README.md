# Product Service

A Nest.js microservice for managing products with full CRUD operations.

## Features

- ✅ RESTful API for product management
- ✅ PostgreSQL database integration with TypeORM
- ✅ Input validation using class-validator
- ✅ Product inventory management
- ✅ Soft delete functionality
- ✅ Comprehensive error handling

## Prerequisites

- Node.js (v18 or higher)
- Docker and Docker Compose (recommended) OR PostgreSQL (v12 or higher)
- npm or yarn

## Quick Start with Docker Compose

The easiest way to get started is using Docker Compose for PostgreSQL:

1. **Start PostgreSQL using Docker Compose** (from the root `microservices-assignment` directory):
```bash
cd ..
docker-compose up -d
```

This will:
- Start PostgreSQL 15 in a Docker container
- Create `product_db` and `order_db` databases automatically
- Expose PostgreSQL on port 5432

2. **Navigate to product-service and install dependencies**:
```bash
cd product-service
npm install
```

3. **Set up environment variables**:
   - Create a `.env` file in the root directory
   - Copy the following template:

```env
# Database Configuration
DB_HOST=localhost
DB_PORT=5432
DB_USERNAME=postgres
DB_PASSWORD=postgres
DB_DATABASE=product_db

# Application Configuration
PORT=3000
NODE_ENV=development
```

4. **Start the service**:
```bash
npm run start:dev
```

## Manual Installation (Without Docker)

1. Clone the repository and navigate to the project directory:
```bash
cd product-service
```

2. Install dependencies:
```bash
npm install
```

3. Set up environment variables:
   - Create a `.env` file in the root directory
   - Copy the following template and update with your database credentials:

```env
# Database Configuration
DB_HOST=localhost
DB_PORT=5432
DB_USERNAME=postgres
DB_PASSWORD=postgres
DB_DATABASE=product_db

# Application Configuration
PORT=3000
NODE_ENV=development
```

4. Create the PostgreSQL database:
```bash
# Using psql
psql -U postgres
CREATE DATABASE product_db;
```

## Running the Application

### Development Mode
```bash
npm run start:dev
```

The service will start on `http://localhost:3000` (or the port specified in your `.env` file).

### Production Mode
```bash
npm run build
npm run start:prod
```

## API Endpoints

### Products

| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/products` | Create a new product |
| GET | `/products` | Get all products (optional query: `?status=ACTIVE`) |
| GET | `/products/:id` | Get a product by ID |
| PATCH | `/products/:id` | Update a product |
| PATCH | `/products/:id/inventory` | Update product inventory (add/subtract) |
| DELETE | `/products/:id` | Soft delete a product (sets status to INACTIVE) |

### Request/Response Examples

#### Create Product
```bash
POST /products
Content-Type: application/json

{
  "name": "Laptop",
  "description": "High-performance laptop",
  "price": 999.99,
  "currency": "USD",
  "inventoryCount": 50,
  "status": "ACTIVE"
}
```
Note: SKU is automatically generated by the backend based on the product name.

#### Update Product
```bash
PATCH /products/:id
Content-Type: application/json

{
  "name": "Updated Laptop Name",
  "price": 899.99
}
```

#### Update Inventory
```bash
PATCH /products/:id/inventory
Content-Type: application/json

{
  "quantity": -5
}
```
Note: Use negative values to decrease inventory, positive to increase.

#### Get Products with Status Filter
```bash
GET /products?status=ACTIVE
```

## Database Schema

### Products Table

| Column | Type | Description |
|--------|------|-------------|
| id | UUID | Primary key |
| sku | String (unique) | Stock Keeping Unit |
| name | String | Product name |
| description | Text | Product description |
| price | Decimal | Product price |
| currency | String | Currency code (default: USD) |
| inventoryCount | Integer | Available inventory |
| status | Enum | ACTIVE or INACTIVE |
| createdAt | Timestamp | Creation date |
| updatedAt | Timestamp | Last update date |

## Project Structure

```
src/
├── config/
│   └── database.config.ts    # Database configuration
├── products/
│   ├── dto/
│   │   ├── create-product.dto.ts
│   │   ├── update-product.dto.ts
│   │   └── update-inventory.dto.ts
│   ├── entities/
│   │   └── product.entity.ts
│   ├── products.controller.ts
│   ├── products.service.ts
│   └── products.module.ts
├── app.module.ts
└── main.ts
```
